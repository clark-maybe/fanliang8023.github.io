---
layout: post
title: "å…³äºReactç”Ÿå‘½å‘¨æœŸçš„é‚£äº›äº‹å„¿"
date: 2019-03-22
description: "å…³äºReactç”Ÿå‘½å‘¨æœŸçš„é‚£äº›äº‹å„¿"
tag: æŠ€æœ¯åˆ†äº«
---   



ç”Ÿå‘½å‘¨æœŸï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä»ç”Ÿåˆ°æ­»çš„è¿‡ç¨‹ã€‚

è€Œç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œå°±æ˜¯ä»ç”Ÿåˆ°æ­»è¿‡ç¨‹ä¸­çš„å…³é”®èŠ‚ç‚¹ã€‚

æ™®é€šäººçš„ä¸€ç”Ÿæœ‰å“ªäº›ç”Ÿå‘½å‘¨æœŸé’©å­å‘¢ï¼Ÿ

- å‡ºç”Ÿ
- è€ƒä¸Šå¤§å­¦
- ç¬¬ä¸€ä»½å·¥ä½œ
- ä¹°æˆ¿
- ç»“å©š
- ç”Ÿå­
- å­©å­çš„ç”Ÿå‘½å‘¨æœŸé’©å­
- é€€ä¼‘
- ä¸´ç»ˆé—è¨€

æ¯åˆ°å…³é”®èŠ‚ç‚¹ï¼Œæˆ‘ä»¬æ€»å¸Œæœ›æœ‰ä¸€äº›æ²‰æ€æ—¶åˆ»ï¼Œå› ä¸ºè¿™æ—¶å€™åšå‡ºçš„å†³ç­–ä¼šæ”¹å˜äººç”Ÿçš„èµ°å‘ã€‚

Reactç»„ä»¶ä¹Ÿä¸€æ ·ï¼Œå®ƒä¼šç»™å¼€å‘è€…ä¸€äº›æ²‰æ€æ—¶åˆ»ï¼Œåœ¨è¿™é‡Œï¼Œå¼€å‘è€…å¯ä»¥æ”¹å˜ç»„ä»¶çš„èµ°å‘ã€‚

## å¼‚æ­¥æ¸²æŸ“ä¸‹çš„ç”Ÿå‘½å‘¨æœŸ

ReactèŠ±äº†ä¸¤å¹´æ—¶é—´ç¥­å‡ºFiberæ¸²æŸ“æœºåˆ¶ã€‚

ç®€å•æ¥è¯´ï¼ŒReactå°†diffçš„è¿‡ç¨‹å«åšReconciliationã€‚ä»¥å‰è¿™ä¸€è¿‡ç¨‹æ˜¯ä¸€æ°”å‘µæˆçš„ï¼ŒFiberæœºåˆ¶æŠŠå®ƒæ”¹æˆäº†å¼‚æ­¥ã€‚å¼‚æ­¥æŠ€èƒ½å°†åœ¨æ¥ä¸‹æ¥çš„ç‰ˆæœ¬ä¸­é€æ­¥è§£é”ã€‚

æ˜æ˜æ˜¯ä¸€æ®µåŒæ­¥ä»£ç ï¼Œæ€ä¹ˆå°±å¼‚æ­¥äº†å‘¢ï¼Ÿ

åŸç†æ˜¯FiberæŠŠä»»åŠ¡åˆ‡æˆå¾ˆå°çš„ç‰‡ï¼Œæ¯æ‰§è¡Œä¸€ç‰‡å°±æŠŠæ§åˆ¶æƒäº¤è¿˜ç»™ä¸»çº¿ç¨‹ï¼Œå¾…ä¸»çº¿ç¨‹å¿™å®Œæ‰‹å¤´çš„æ´»å†æ¥æ‰§è¡Œå‰©ä¸‹çš„ä»»åŠ¡ã€‚å½“ç„¶å¦‚æœæŸä¸€ç‰‡çš„æ‰§è¡Œæ—¶é—´å°±å¾ˆé•¿(æ¯”å¦‚æ­»å¾ªç¯)ï¼Œé‚£å°±æ²¡ä¸»çº¿ç¨‹ä»€ä¹ˆäº‹äº†ï¼Œè¯¥å´©æºƒå´©æºƒã€‚

è¿™ä¼šç»™ç”Ÿå‘½å‘¨æœŸå¸¦æ¥ä»€ä¹ˆå½±å“å‘¢ï¼Ÿ

å½±å“å°±æ˜¯æŒ‚è½½å’Œæ›´æ–°ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸéƒ½å˜çš„ä¸å¯é äº†ã€‚

ä¸ºä»€ä¹ˆè¿™ä¹ˆè®²ï¼Ÿå› ä¸ºReconciliationè¿™ä¸ªè¿‡ç¨‹æœ‰å¯èƒ½æš‚åœç„¶åç»§ç»­æ‰§è¡Œï¼Œæ‰€ä»¥æŒ‚è½½å’Œæ›´æ–°ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸé’©å­å°±æœ‰å¯èƒ½ä¸æ‰§è¡Œæˆ–è€…å¤šæ¬¡æ‰§è¡Œï¼Œå®ƒçš„è¡¨ç°æ˜¯ä¸å¯é¢„æœŸçš„ã€‚

å› æ­¤16ä¹‹åçš„Reactç”Ÿå‘½å‘¨æœŸè¿æ¥äº†ä¸€æ³¢å¤§æ¢è¡€ï¼Œä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸé’©å­å°†è¢«é€æ¸åºŸå¼ƒï¼š

- componentWillMount
- componentWillReceiveProps
- componentWillUpdate

çœ‹å‡ºç‰¹ç‚¹äº†ä¹ˆï¼Œéƒ½æ˜¯å¸¦æœ‰`will`çš„é’©å­ã€‚

ç›®å‰Reactä¸ºè¿™å‡ ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­æä¾›äº†åˆ«åï¼Œåˆ†åˆ«æ˜¯ï¼š

- UNSAFE_componentWillMount
- UNSAFE_componentWillReceiveProps
- UNSAFE_componentWillUpdate

React17å°†åªæä¾›åˆ«åï¼Œå½»åº•åºŸå¼ƒè¿™ä¸‰ä¸ªå¤§æ´»å®ã€‚å–è¿™ä¹ˆä¸ªåˆ«åæ„æ€å°±æ˜¯è®©ä½ ç”¨ç€æ¶å¿ƒã€‚

## constructor()

Reactå€Ÿç”¨classç±»çš„`constructor`å……å½“åˆå§‹åŒ–é’©å­ã€‚

Reactå‡ ä¹æ²¡åšä»€ä¹ˆæ‰‹è„šï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬åªå…è®¸é€šè¿‡ç‰¹å®šçš„é€”å¾„ç»™ç»„ä»¶ä¼ é€’å‚æ•°ï¼Œæ‰€ä»¥`constructor`çš„å‚æ•°å®é™…ä¸Šæ˜¯è¢«Reactè§„å®šå¥½çš„ã€‚

Reactè§„å®š`constructor`æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯`props`ã€`context`å’Œ`updater`ã€‚

- `props`æ˜¯å±æ€§ï¼Œå®ƒæ˜¯ä¸å¯å˜çš„ã€‚
- `context`æ˜¯å…¨å±€ä¸Šä¸‹æ–‡ã€‚
- `updater`æ˜¯åŒ…å«ä¸€äº›æ›´æ–°æ–¹æ³•çš„å¯¹è±¡ï¼Œ`this.setState`æœ€ç»ˆè°ƒç”¨çš„æ˜¯`this.updater.enqueueSetState`æ–¹æ³•ï¼Œ`this.forceUpdate`æœ€ç»ˆè°ƒç”¨çš„æ˜¯`this.updater.enqueueForceUpdate`æ–¹æ³•ï¼Œæ‰€ä»¥è¿™äº›APIæ›´å¤šæ˜¯Reactå†…éƒ¨ä½¿ç”¨ï¼Œæš´éœ²å‡ºæ¥æ˜¯ä»¥å¤‡å¼€å‘è€…ä¸æ—¶ä¹‹éœ€ã€‚

åœ¨Reactä¸­ï¼Œå› ä¸ºæ‰€æœ‰classç»„ä»¶éƒ½è¦ç»§æ‰¿è‡ª`Component`ç±»æˆ–è€…`PureComponent`ç±»ï¼Œå› æ­¤å’ŒåŸç”Ÿclasså†™æ³•ä¸€æ ·ï¼Œè¦åœ¨`constructor`é‡Œé¦–å…ˆè°ƒç”¨`super`æ–¹æ³•ï¼Œæ‰èƒ½è·å¾—`this`ã€‚

`constructor`ç”Ÿå‘½å‘¨æœŸé’©å­çš„æœ€ä½³å®è·µæ˜¯åœ¨è¿™é‡Œåˆå§‹åŒ–`this.state`ã€‚

å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å±æ€§åˆå§‹åŒ–å™¨æ¥ä»£æ›¿ï¼Œå¦‚ä¸‹ï¼š

```javascript
import React, { Component } from 'react';

class App extends Component {
    state = {
        name: 'biu',
    };
}

export default App;
```

## componentWillMount()

> ğŸ’€è¿™æ˜¯Reactä¸å†æ¨èä½¿ç”¨çš„APIã€‚

è¿™æ˜¯ç»„ä»¶æŒ‚è½½åˆ°DOMä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚

å¾ˆå¤šäººä¼šæœ‰ä¸€ä¸ªè¯¯åŒºï¼šè¿™ä¸ªé’©å­æ˜¯è¯·æ±‚æ•°æ®ç„¶åå°†æ•°æ®æ’å…¥å…ƒç´ ä¸€åŒæŒ‚è½½çš„æœ€ä½³æ—¶æœºã€‚

å…¶å®`componentWillMount`å’ŒæŒ‚è½½æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œæ„å‘³ç€æ‰§è¡Œå®Œè¿™ä¸ªé’©å­ï¼Œç«‹å³æŒ‚è½½ã€‚è€Œå‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚æ‰€ä»¥æ— è®ºè¯·æ±‚æ€ä¹ˆå¿«ï¼Œéƒ½è¦æ’åœ¨åŒæ­¥ä»»åŠ¡ä¹‹åå†å¤„ç†ï¼Œè¿™æ˜¯è¾ˆåˆ†é—®é¢˜ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œæ°¸è¿œä¸å¯èƒ½åœ¨è¿™é‡Œå°†æ•°æ®æ’å…¥å…ƒç´ ä¸€åŒæŒ‚è½½ã€‚

å¹¶ä¸æ˜¯è¯´ä¸èƒ½åœ¨è¿™é‡Œè¯·æ±‚æ•°æ®ï¼Œè€Œæ˜¯è¾¾ä¸åˆ°ä½ è‡†æƒ³çš„æ•ˆæœã€‚

å®ƒè¢«åºŸå¼ƒçš„åŸå› ä¸»è¦æœ‰ä¸‰ç‚¹ï¼š

- æœ¬æ¥å®ƒå°±æ²¡ä»€ä¹ˆç”¨ã€‚ä¼°è®¡å½“åˆæ˜¯ä¸ºäº†æˆåŒæˆå¯¹æ‰€ä»¥æ‰åˆ›é€ äº†å®ƒå§ã€‚
- å¦‚æœå®ƒå£°æ˜äº†å®šæ—¶å™¨æˆ–è€…è®¢é˜…å™¨ï¼Œåœ¨æœåŠ¡ç«¯æ¸²æŸ“ä¸­ï¼Œ`componentWillUnmount`ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­çš„æ¸…é™¤ä»£ç ä¸ä¼šç”Ÿæ•ˆã€‚å› ä¸ºå¦‚æœç»„ä»¶æ²¡æœ‰æŒ‚è½½æˆåŠŸï¼Œ`componentWillUnmount`æ˜¯ä¸ä¼šæ‰§è¡Œçš„ã€‚å§šæ˜è¯´çš„ï¼šæ²¡æœ‰æŒ‚è½½å°±æ²¡æœ‰å¸è½½ã€‚
- åœ¨å¼‚æ­¥æ¸²æŸ“ä¸­ï¼Œå®ƒçš„è¡¨ç°ä¸ç¨³å®šã€‚

åˆå§‹åŒ–`this.state`åº”è¯¥åœ¨`constructor`ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­å®Œæˆï¼Œè¯·æ±‚æ•°æ®åº”è¯¥åœ¨`componentDidMount`ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­å®Œæˆï¼Œæ‰€ä»¥å®ƒä¸ä»…è¢«åºŸå¼ƒäº†ï¼Œè¿ç»§ä»»è€…éƒ½æ²¡æœ‰ã€‚

## static getDerivedStateFromProps(props, state)

> ğŸ‘½è¿™æ˜¯React v16.3.0å‘å¸ƒçš„APIã€‚

é¦–å…ˆï¼Œè¿™æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œå®šä¹‰çš„æ—¶å€™å¾—åœ¨æ–¹æ³•å‰åŠ ä¸€ä¸ª`static`å…³é”®å­—ï¼Œæˆ–è€…ç›´æ¥æŒ‚è½½åˆ°classç±»ä¸Šã€‚

ç®€è¦åŒºåˆ†ä¸€ä¸‹å®ä¾‹æ–¹æ³•å’Œé™æ€æ–¹æ³•ï¼š

- å®ä¾‹æ–¹æ³•ï¼ŒæŒ‚è½½åœ¨`this`ä¸Šæˆ–è€…æŒ‚è½½åœ¨`prototype`ä¸Šï¼Œclassç±»ä¸èƒ½ç›´æ¥è®¿é—®è¯¥æ–¹æ³•ï¼Œä½¿ç”¨`new`å…³é”®å­—å®ä¾‹åŒ–ä¹‹åï¼Œå®ä¾‹å¯ä»¥è®¿é—®è¯¥æ–¹æ³•ã€‚
- é™æ€æ–¹æ³•ï¼Œç›´æ¥æŒ‚è½½åœ¨classç±»ä¸Šï¼Œæˆ–è€…ä½¿ç”¨æ–°çš„å…³é”®å­—`static`ï¼Œå®ä¾‹æ— æ³•ç›´æ¥è®¿é—®è¯¥æ–¹æ³•ã€‚

é—®é¢˜æ˜¯ï¼Œä¸ºä»€ä¹ˆ`getDerivedStateFromProps`ç”Ÿå‘½å‘¨æœŸé’©å­è¦è®¾è®¡æˆé™æ€æ–¹æ³•å‘¢ï¼Ÿ

è¿™æ ·å¼€å‘è€…å°±è®¿é—®ä¸åˆ°`this`ä¹Ÿå°±æ˜¯å®ä¾‹äº†ï¼Œä¹Ÿå°±ä¸èƒ½åœ¨é‡Œé¢è°ƒç”¨å®ä¾‹æ–¹æ³•æˆ–è€…setsStateäº†ã€‚

```javascript
import React, { Component } from 'react';

class App extends Component {
    render() {
        return (
            <div>React</div>
        );
    }

    static getDerivedStateFromProps(props, state) {}
}

export default App;
```

è¿™ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­çš„ä½¿å‘½æ˜¯æ ¹æ®çˆ¶ç»„ä»¶ä¼ æ¥çš„propsæŒ‰éœ€æ›´æ–°è‡ªå·±çš„stateï¼Œè¿™ç§stateå«åšè¡ç”Ÿstateã€‚è¿”å›çš„å¯¹è±¡å°±æ˜¯è¦å¢é‡æ›´æ–°çš„stateã€‚

å®ƒè¢«è®¾è®¡æˆé™æ€æ–¹æ³•çš„ç›®çš„æ˜¯ä¿æŒè¯¥æ–¹æ³•çš„çº¯ç²¹ï¼Œå®ƒå°±æ˜¯ç”¨æ¥å®šä¹‰è¡ç”Ÿstateçš„ï¼Œé™¤æ­¤ä¹‹å¤–ä¸åº”è¯¥åœ¨é‡Œé¢æ‰§è¡Œä»»ä½•æ“ä½œã€‚

è¿™ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­ä¹Ÿç»å†äº†ä¸€äº›æ³¢æŠ˜ï¼ŒåŸæœ¬å®ƒæ˜¯è¢«è®¾è®¡æˆ`åˆå§‹åŒ–`ã€`çˆ¶ç»„ä»¶æ›´æ–°`å’Œ`æ¥æ”¶åˆ°props`æ‰ä¼šè§¦å‘ï¼Œç°åœ¨åªè¦æ¸²æŸ“å°±ä¼šè§¦å‘ï¼Œä¹Ÿå°±æ˜¯`åˆå§‹åŒ–`å’Œ`æ›´æ–°é˜¶æ®µ`éƒ½ä¼šè§¦å‘ã€‚

## render()

ä½œä¸ºä¸€ä¸ªç»„ä»¶ï¼Œæœ€æ ¸å¿ƒçš„åŠŸèƒ½å°±æ˜¯æŠŠå…ƒç´ æŒ‚è½½åˆ°DOMä¸Šï¼Œæ‰€ä»¥`render`ç”Ÿå‘½å‘¨æœŸé’©å­æ˜¯ä¸€å®šä¼šç”¨åˆ°çš„ã€‚

`render`ç”Ÿå‘½å‘¨æœŸé’©å­æ€ä¹ˆæ¥æ”¶æ¨¡æ¿å‘¢ï¼Ÿå½“ç„¶æ˜¯ä½ returnç»™å®ƒã€‚

ä½†æ˜¯ä¸æ¨èåœ¨returnä¹‹å‰å†™è¿‡å¤šçš„é€»è¾‘ï¼Œå¦‚æœé€»è¾‘è¿‡å¤šï¼Œå¯ä»¥å°è£…æˆä¸€ä¸ªå‡½æ•°ã€‚

```javascript
render() {
    // è¿™é‡Œå¯ä»¥å†™ä¸€äº›é€»è¾‘
    return (
        <div>
            <input type="text" />
            <button>click</button>
        </div>
    );
}
```

æ³¨æ„ï¼Œåƒä¸‡ä¸è¦åœ¨`render`ç”Ÿå‘½å‘¨æœŸé’©å­é‡Œè°ƒç”¨`this.setState`ï¼Œå› ä¸º`this.setState`ä¼šå¼•å‘renderï¼Œè¿™ä¸‹å°±æ²¡å®Œæ²¡äº†äº†ã€‚ä¸»å…¬ï¼Œæœ‰å†…å¥¸ã€‚

## componentDidMount()

è¿™æ˜¯ç»„ä»¶æŒ‚è½½åˆ°DOMä¹‹åçš„ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚

è¿™å¯èƒ½æ˜¯é™¤äº†`render`ä¹‹å¤–æœ€é‡è¦çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œå› ä¸ºè¿™æ—¶å€™ç»„ä»¶çš„å„æ–¹é¢éƒ½å‡†å¤‡å°±ç»ªï¼Œå¤©åœ°ä»»ä½ é—¯ã€‚

è¿™å°±æ˜¯ç¤¾ä¼šå“¥ï¼Œäººç‹ è¯ä¸å¤šã€‚

## componentWillReceiveProps(nextProps)

> ğŸ’€è¿™æ˜¯Reactä¸å†æ¨èä½¿ç”¨çš„APIã€‚

`componentWillReceiveProps`ç”Ÿå‘½å‘¨æœŸé’©å­åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œæ›´æ–°åçš„propsã€‚

è¯¥å£°æ˜å‘¨æœŸå‡½æ•°å¯èƒ½åœ¨ä¸¤ç§æƒ…å†µä¸‹è¢«è§¦å‘ï¼š

- ç»„ä»¶æ¥æ”¶åˆ°äº†æ–°çš„å±æ€§ã€‚
- ç»„ä»¶æ²¡æœ‰æ”¶åˆ°æ–°çš„å±æ€§ï¼Œä½†æ˜¯ç”±äºçˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“å¯¼è‡´å½“å‰ç»„ä»¶ä¹Ÿè¢«é‡æ–°æ¸²æŸ“ã€‚

åˆå§‹åŒ–æ—¶å¹¶ä¸ä¼šè§¦å‘è¯¥ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚

åŒæ ·ï¼Œå› ä¸ºFiberæœºåˆ¶çš„å¼•å…¥ï¼Œè¿™ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­æœ‰å¯èƒ½ä¼šå¤šæ¬¡è§¦å‘ã€‚

## shouldComponentUpdate(nextProps, nextState)

è¿™ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­æ˜¯ä¸€ä¸ªå¼€å…³ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œä¸»è¦ç”¨æ¥ä¼˜åŒ–æ€§èƒ½ã€‚

æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œå¦‚æœå¼€å‘è€…è°ƒç”¨`this.forceUpdate`å¼ºåˆ¶æ›´æ–°ï¼ŒReactç»„ä»¶ä¼šæ— è§†è¿™ä¸ªé’©å­ã€‚

`shouldComponentUpdate`ç”Ÿå‘½å‘¨æœŸé’©å­é»˜è®¤è¿”å›trueã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œåªè¦ç»„ä»¶è§¦å‘äº†æ›´æ–°ï¼Œç»„ä»¶å°±ä¸€å®šä¼šæ›´æ–°ã€‚ReactæŠŠåˆ¤æ–­çš„æ§åˆ¶æƒç»™äº†å¼€å‘è€…ã€‚

ä¸è¿‡å‘¨åˆ°çš„Reactè¿˜æä¾›äº†ä¸€ä¸ª`PureComponent`åŸºç±»ï¼Œå®ƒä¸`Component`åŸºç±»çš„åŒºåˆ«æ˜¯`PureComponent`è‡ªåŠ¨å®ç°äº†ä¸€ä¸ª`shouldComponentUpdate`ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚

å¯¹äºç»„ä»¶æ¥è¯´ï¼Œåªæœ‰çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œæ‰éœ€è¦é‡æ–°æ¸²æŸ“ã€‚æ‰€ä»¥`shouldComponentUpdate`ç”Ÿå‘½å‘¨æœŸé’©å­æš´éœ²äº†ä¸¤ä¸ªå‚æ•°ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡æ¯”è¾ƒ`this.props`å’Œ`nextProps`ã€`this.state`å’Œ`nextState`æ¥åˆ¤æ–­çŠ¶æ€åˆ°åº•æœ‰æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œå†ç›¸åº”çš„è¿”å›trueæˆ–falseã€‚

ä»€ä¹ˆæƒ…å†µä¸‹çŠ¶æ€æ²¡æ”¹å˜ï¼Œå´ä¾ç„¶è§¦å‘äº†æ›´æ–°å‘¢ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼š

çˆ¶ç»„ä»¶ç»™å­ç»„ä»¶ä¼ äº†ä¸€ä¸ªå€¼ï¼Œå½“çˆ¶ç»„ä»¶çŠ¶æ€å˜åŒ–ï¼Œå³ä¾¿å­ç»„ä»¶æ¥æ”¶åˆ°çš„å€¼æ²¡æœ‰å˜åŒ–ï¼Œå­ç»„ä»¶ä¹Ÿä¼šè¢«è¿«æ›´æ–°ã€‚è¿™æ˜¾ç„¶æ˜¯éå¸¸ä¸åˆç†çš„ï¼ŒReactå¯¹æ­¤æ— èƒ½ä¸ºåŠ›ï¼Œåªèƒ½çœ‹å¼€å‘è€…çš„ä¸ªäººé€ åŒ–äº†ã€‚

```javascript
import React, { Component } from 'react';
import Child from './Child';

class App extends Component {
    state = { name: 'React', star: 1 };

    render() {
        const { name, star } = this.state;
        return (
            <div>
                <Child name={name} />
                <div>{star}</div>
                <button onClick={this.handle}>click</button>
            </div>
        );
    }

	handle = () => {
        this.setState(prevState => ({ star: ++prevState.star }));
    }
}

export default App;
```

```javascript
import React, { Component } from 'react';

class Child extends Component {
    render() {
        return <h1>{this.props.name}</h1>;
    }

    shouldComponentUpdate(nextProps, nextState) {
        if (this.props === nextProps) {
            return false;
        } else {
            return true;
        }
    }
}

export default Child;
```

åŒæ—¶è¦æ³¨æ„å¼•ç”¨ç±»å‹çš„å‘ã€‚

ä¸‹é¢è¿™ç§æƒ…å†µï¼Œ`this.props`å’Œ`nextProps`æ°¸è¿œä¸å¯èƒ½ç›¸ç­‰ã€‚

```javascript
import React, { Component } from 'react';
import Child from './Child';

class App extends Component {
    state = { name: 'React', star: 1 };

    render() {
        return (
            <div>
                <Child name={{ friend: 'Vue' }} />
                <div>{this.state.star}</div>
                <button onClick={this.handle}>click</button>
            </div>
        );
    }

	handle = () => {
        this.setState(prevState => ({ star: ++prevState.star }));
    }
}

export default App;
```

```javascript
import React, { Component } from 'react';

class Child extends Component {
    render() {
        return <h1>{this.props.friend}</h1>;
    }

    shouldComponentUpdate(nextProps, nextState) {
        if (this.props === nextProps) {
            return false;
        } else {
            return true;
        }
    }
}

export default Child;
```

è§£å†³æ–¹æ³•æœ‰ä¸¤ä¸ªï¼š

- æ¯”è¾ƒ`this.props.xxx`å’Œ`nextProps.xxx`ã€‚
- åœ¨çˆ¶ç»„ä»¶ç”¨ä¸€ä¸ªå˜é‡å°†å¼•ç”¨ç±»å‹ç¼“å­˜èµ·æ¥ã€‚

æ‰€ä»¥`this.state`å’Œ`nextState`æ˜¯åªèƒ½ç”¨ç¬¬ä¸€ç§æ–¹æ³•æ¯”è¾ƒäº†ï¼Œå› ä¸ºReactæ¯æ¬¡æ›´æ–°stateéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¿®æ”¹åŸå¯¹è±¡ã€‚

## componentWillUpdate(nextProps, nextState)

> ğŸ’€è¿™æ˜¯Reactä¸å†æ¨èä½¿ç”¨çš„APIã€‚

`shouldComponentUpdate`ç”Ÿå‘½å‘¨æœŸé’©å­è¿”å›trueï¼Œæˆ–è€…è°ƒç”¨`this.forceUpdate`ä¹‹åï¼Œä¼šç«‹å³æ‰§è¡Œè¯¥ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚

è¦ç‰¹åˆ«æ³¨æ„ï¼Œ`componentWillUpdate`ç”Ÿå‘½å‘¨æœŸé’©å­æ¯æ¬¡æ›´æ–°å‰éƒ½ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥åœ¨è¿™é‡Œè°ƒç”¨`this.setState`éå¸¸å±é™©ï¼Œæœ‰å¯èƒ½ä¼šæ²¡å®Œæ²¡äº†ã€‚

åŒæ ·ï¼Œå› ä¸ºFiberæœºåˆ¶çš„å¼•å…¥ï¼Œè¿™ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­æœ‰å¯èƒ½ä¼šå¤šæ¬¡è°ƒç”¨ã€‚

## getSnapshotBeforeUpdate(prevProps, prevState)

> ğŸ‘½è¿™æ˜¯React v16.3.0å‘å¸ƒçš„APIã€‚

é¡¾åæ€ä¹‰ï¼Œä¿å­˜çŠ¶æ€å¿«ç…§ç”¨çš„ã€‚

å®ƒä¼šåœ¨ç»„ä»¶å³å°†æŒ‚è½½æ—¶è°ƒç”¨ï¼Œæ³¨æ„ï¼Œæ˜¯å³å°†æŒ‚è½½ã€‚å®ƒç”šè‡³è°ƒç”¨çš„æ¯”`render`è¿˜æ™šï¼Œç”±æ­¤å¯è§`render`å¹¶æ²¡æœ‰å®ŒæˆæŒ‚è½½æ“ä½œï¼Œè€Œæ˜¯è¿›è¡Œæ„å»ºæŠ½è±¡UIçš„å·¥ä½œã€‚`getSnapshotBeforeUpdate`æ‰§è¡Œå®Œå°±ä¼šç«‹å³è°ƒç”¨`componentDidUpdate`ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚

å®ƒæ˜¯åšä»€ä¹ˆç”¨çš„å‘¢ï¼Ÿæœ‰ä¸€äº›çŠ¶æ€ï¼Œæ¯”å¦‚ç½‘é¡µæ»šåŠ¨ä½ç½®ï¼Œæˆ‘ä¸éœ€è¦å®ƒæŒä¹…åŒ–ï¼Œåªéœ€è¦åœ¨ç»„ä»¶æ›´æ–°ä»¥åèƒ½å¤Ÿæ¢å¤åŸæ¥çš„ä½ç½®å³å¯ã€‚

`getSnapshotBeforeUpdate`ç”Ÿå‘½å‘¨æœŸé’©å­è¿”å›çš„å€¼ä¼šè¢«`componentDidUpdate`çš„ç¬¬ä¸‰ä¸ªå‚æ•°æ¥æ”¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªé€šé“ä¿å­˜ä¸€äº›ä¸éœ€è¦æŒä¹…åŒ–çš„çŠ¶æ€ï¼Œç”¨å®Œå³å¯èˆå¼ƒã€‚

å¾ˆæ˜¾ç„¶ï¼Œå®ƒæ˜¯ç”¨æ¥å–ä»£`componentWillUpdate`ç”Ÿå‘½å‘¨æœŸé’©å­çš„ã€‚

æ„æ€å°±æ˜¯è¯´å‘€ï¼Œå¼€å‘è€…ä¸€èˆ¬ç”¨ä¸åˆ°å®ƒã€‚

## componentDidUpdate(nextProps, nextState, snapshot)

è¿™æ˜¯ç»„ä»¶æ›´æ–°ä¹‹åè§¦å‘çš„ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚

æ­é…`getSnapshotBeforeUpdate`ç”Ÿå‘½å‘¨æœŸé’©å­ä½¿ç”¨çš„æ—¶å€™ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯`getSnapshotBeforeUpdate`çš„è¿”å›å€¼ã€‚

åŒæ ·çš„ï¼Œ`componentDidUpdate`ç”Ÿå‘½å‘¨æœŸé’©å­æ¯æ¬¡æ›´æ–°åéƒ½ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥åœ¨è¿™é‡Œè°ƒç”¨`this.setState`ä¹Ÿéå¸¸å±é™©ï¼Œæœ‰å¯èƒ½ä¼šæ²¡å®Œæ²¡äº†ã€‚

## componentWillUnmount()

è¿™æ˜¯ç»„ä»¶å¸è½½ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚

ä¸ºä»€ä¹ˆç»„ä»¶å¿«è¦å¸è½½äº†è¿˜éœ€è¦æ²‰æ€æ—¶åˆ»å‘¢ï¼Ÿ

å› ä¸ºå¼€å‘è€…è¦æ“¦å±è‚¡å–ã€‚

Reactçš„æœ€ä½³å®è·µæ˜¯ï¼Œç»„ä»¶ä¸­ç”¨åˆ°çš„äº‹ä»¶ç›‘å¬å™¨ã€è®¢é˜…å™¨ã€å®šæ—¶å™¨éƒ½è¦åœ¨è¿™é‡Œé”€æ¯ã€‚

å½“ç„¶æˆ‘è¯´çš„äº‹ä»¶ç›‘å¬å™¨æŒ‡çš„æ˜¯è¿™ç§ï¼š

```javascript
componentDidMount() {
    document.addEventListener('click', () => {});
}
```

å› ä¸ºä¸‹é¢è¿™ç§Reactä¼šè‡ªåŠ¨é”€æ¯ï¼Œä¸åŠ³çƒ¦å¼€å‘è€…äº†ã€‚

```javascript
render() {
    return (
        <button onClick={this.handle}>click</button>
    );
}
```

## componentDidCatch(error, info)

> ğŸ‘½è¿™æ˜¯React v16.3.0å‘å¸ƒçš„APIã€‚

å®ƒä¸»è¦ç”¨æ¥æ•è·é”™è¯¯å¹¶è¿›è¡Œç›¸åº”å¤„ç†ï¼Œæ‰€ä»¥å®ƒçš„ç”¨æ³•ä¹Ÿæ¯”è¾ƒç‰¹æ®Šã€‚

å®šåˆ¶ä¸€ä¸ªåªæœ‰`componentDidCatch`ç”Ÿå‘½å‘¨æœŸé’©å­çš„`ErrorBoundary`ç»„ä»¶ï¼Œå®ƒåªåšä¸€ä»¶äº‹ï¼šå¦‚æœæ•è·åˆ°é”™è¯¯ï¼Œåˆ™æ˜¾ç¤ºé”™è¯¯æç¤ºï¼Œå¦‚æœæ²¡æœ‰æ•è·åˆ°é”™è¯¯ï¼Œåˆ™æ˜¾ç¤ºå­ç»„ä»¶ã€‚

å°†éœ€è¦æ•è·é”™è¯¯çš„ç»„ä»¶ä½œä¸º`ErrorBoundary`çš„å­ç»„ä»¶æ¸²æŸ“ï¼Œä¸€æ—¦å­ç»„ä»¶æŠ›å‡ºé”™è¯¯ï¼Œæ•´ä¸ªåº”ç”¨ä¾ç„¶ä¸ä¼šå´©æºƒï¼Œè€Œæ˜¯è¢«`ErrorBoundary`æ•è·ã€‚

```javascript
import React, { Component } from 'react';

class ErrorBoundary extends Component {
    state = { hasError: false };

    render() {
        if (this.state.hasError) {
            return <h1>Something went wrong.</h1>;
        }
        return this.props.children;
    }

    componentDidCatch(error, info) {
        this.setState({ hasError: true });
    }
}

export default ErrorBoundary;
```

```javascript
import React from 'react';
import ErrorBoundary from './ErrorBoundary';
import MyWidget from './MyWidget';

const App = () => {
    return (
        <ErrorBoundary>
            <MyWidget />
        </ErrorBoundary>
    );
}

export default App;
```

## ç”Ÿå‘½å‘¨æœŸ

è¿™ä¹ˆå¤šç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œå®é™…ä¸Šæ€»ç»“èµ·æ¥åªæœ‰ä¸‰ä¸ªè¿‡ç¨‹ï¼š

- æŒ‚è½½
- æ›´æ–°
- å¸è½½

æŒ‚è½½å’Œå¸è½½åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œæ›´æ–°ä¼šæ‰§è¡Œå¤šæ¬¡ã€‚

ä¸€ä¸ªå®Œæ•´çš„Reactç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¼šä¾æ¬¡è°ƒç”¨å¦‚ä¸‹é’©å­ï¼š

#### old lifecycle

- æŒ‚è½½
  - constructor
  - componentWillMount
  - render
  - componentDidMount
- æ›´æ–°
  - componentWillReceiveProps
  - shouldComponentUpdate
  - componentWillUpdate
  - render
  - componentDidUpdate

- å¸è½½
  - componentWillUnmount

#### new lifecycle

- æŒ‚è½½

  - constructor
  - getDerivedStateFromProps
  - render
  - componentDidMount

- æ›´æ–°

  - getDerivedStateFromProps
  - shouldComponentUpdate
  - render
  - getSnapshotBeforeUpdate
  - componentDidUpdate

- å¸è½½
  - componentWillUnmount

## ç»„ä»¶æ ‘ç”Ÿå‘½å‘¨æœŸè°ƒç”¨æ ˆ

åº”ç”¨åˆæ¬¡æŒ‚è½½æ—¶ï¼Œæˆ‘ä»¬ä»¥`render`å’Œ`componentDidMount`ä¸ºä¾‹ï¼ŒReacté¦–å…ˆä¼šè°ƒç”¨æ ¹ç»„ä»¶çš„`render`é’©å­ï¼Œå¦‚æœæœ‰å­ç»„ä»¶çš„è¯ï¼Œä¾æ¬¡è°ƒç”¨å­ç»„ä»¶çš„`render`é’©å­ï¼Œè°ƒç”¨è¿‡ç¨‹å…¶å®å°±æ˜¯é€’å½’çš„é¡ºåºã€‚

ç­‰æ‰€æœ‰ç»„ä»¶çš„`render`é’©å­éƒ½é€’å½’æ‰§è¡Œå®Œæ¯•ï¼Œè¿™æ—¶å€™æ‰§è¡Œæƒåœ¨æœ€åä¸€ä¸ªå­ç»„ä»¶æ‰‹é‡Œï¼Œäºæ˜¯å¼€å§‹è§¦å‘ä¸‹ä¸€è½®ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œè°ƒç”¨æœ€åä¸€ä¸ªå­ç»„ä»¶çš„`componentDidMount`é’©å­ï¼Œç„¶åè°ƒç”¨æ ˆä¾æ¬¡å¾€ä¸Šé€’å½’ã€‚

ç»„ä»¶æ ‘çš„ç”Ÿå‘½å‘¨æœŸè°ƒç”¨æ ˆèµ°çš„æ˜¯ä¸€ä¸ªZå­—å½¢ã€‚

å¦‚æœæ ¹ç»„ä»¶æ²¡æœ‰å®šä¹‰Aç”Ÿå‘½å‘¨æœŸé’©å­è€Œå­ç»„ä»¶å®šä¹‰äº†ï¼Œé‚£è°ƒç”¨æ ˆå°±ä»è¿™ä¸ªå­ç»„ä»¶çš„Aç”Ÿå‘½å‘¨æœŸé’©å­å¼€å§‹ã€‚

å¦å¤–ï¼Œåªè¦ç»„ä»¶å†…å®šä¹‰äº†æŸä¸ªç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œå³ä¾¿å®ƒæ²¡æœ‰ä»»ä½•åŠ¨ä½œï¼Œä¹Ÿä¼šæ‰§è¡Œã€‚

```javascript
app.render();
child.render();
grandson.render();
// divide
grandson.componentDidMount();
child.componentDidMount();
app.componentDidMount();
// divide
app.render();
child.render();
grandson.render();
// divide
grandson.componentDidUpdate();
child.componentDidUpdate();
app.componentDidUpdate();
```
å½“ç„¶ï¼ŒcomponentWillMountã€componentWillReceivePropså’ŒcomponentWillUpdateç”Ÿå‘½å‘¨æœŸé’©å­æœ‰å¯èƒ½è¢«æ‰“æ–­æ‰§è¡Œï¼Œä¹Ÿæœ‰å¯èƒ½è¢«å¤šæ¬¡è°ƒç”¨ï¼Œè¡¨ç°æ˜¯ä¸ç¨³å®šçš„ã€‚æ‰€ä»¥Reactå†³å®šé€æ­¥åºŸå¼ƒå®ƒä»¬ã€‚

ä¸è¿‡äº†è§£æ•´ä¸ªåº”ç”¨ç”Ÿå‘½å‘¨æœŸçš„æ­£å¸¸è°ƒç”¨é¡ºåºï¼Œè¿˜æ˜¯æœ‰åŠ©äºç†è§£Reactçš„ã€‚

[![LICENSE](https://img.shields.io/badge/license-Anti%20996-blue.svg)](https://github.com/996icu/996.ICU/blob/master/LICENSE)
